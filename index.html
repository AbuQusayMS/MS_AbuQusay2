<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="description" content="مسابقة معلومات تفاعلية لاختبار ثقافتك في مستويات متعددة - تحدٍ ممتع ومفيد">
  <meta name="keywords" content="مسابقة, أسئلة, معلومات عامة, لعبة, اختبار, ثقافة">
  <title>🧠 مسابقة المعلومات | تحدّي المعرفة</title>

  <!-- Favicon and Preconnects -->
  <link rel="icon" type="image/png" href="https://em-content.zobj.net/thumbs/120/apple/354/brain_1f9e0.png">
  <link rel="apple-touch-icon" href="https://em-content.zobj.net/thumbs/120/apple/354/brain_1f9e0.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <!-- External Libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
  <link rel="stylesheet" href="style.css">

  <!-- SEO and Metadata -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "VideoGame",
    "name": "🧠 مسابقة المعلومات",
    "description": "لعبة مسابقة تفاعلية لاختبار المعلومات في مستويات متعددة من السهل إلى المستحيل",
    "applicationCategory": "GameApplication",
    "operatingSystem": "Web Browser",
    "author": {
      "@type": "Person",
      "name": "MS AbuQusay"
    },
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "gamePlatform": "Web Browser"
  }
  </script>
</head>
<body data-theme="dark" style="overflow-x: hidden; -webkit-overflow-scrolling: touch;">
  <noscript>
    <div style="text-align: center; padding: 2rem; font-family: Cairo, sans-serif;">
      <h2>⚠️ تفعيل JavaScript مطلوب</h2>
      <p>هذه اللعبة تتطلب تفعيل JavaScript لتشغيلها بشكل صحيح.</p>
    </div>
  </noscript>

  <!-- Toast Notifications -->
  <div id="toast-container" class="toast-container" aria-live="assertive" aria-atomic="true"></div>

  <!-- Floating Action Button for Reporting -->
  <button id="reportErrorFab" class="report-fab" role="button" aria-label="الإبلاغ عن مشكلة" title="الإبلاغ عن مشكلة">
    <span aria-hidden="true">⚠️</span>
  </button>

  <!-- ========== SCREENS ========== -->
  
  <!-- Loading Screen -->
  <div id="loader" class="screen active" role="status" aria-label="جاري التحميل">
    <div class="loader-content">
      <div class="spinner" aria-hidden="true"></div>
      <p id="loaderText" class="game-subtitle">جاري تحميل اللعبة...</p>
      <div class="loader-progress" aria-hidden="true">
        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Start Screen -->
  <div id="startScreen" class="screen">
    <div class="content-box">
      <header class="screen-header">
        <h1 class="game-title">🧠 مسابقة المعلومات</h1>
        <p class="game-subtitle">اختبر قدراتك في مسابقة تفاعلية شيقة</p>
        <div class="feature-highlights">
          <span class="feature-tag">🎯 4 مستويات</span>
          <span class="feature-tag">⭐ نظام نقاط</span>
          <span class="feature-tag">🏆 لوحة صدارة</span>
        </div>
      </header>
      <div class="button-group">
        <button id="startBtn" class="btn-main" data-action="showAvatarScreen">
          <span class="btn-content">ابدأ اللعب</span>
        </button>
        <button class="btn-secondary" data-action="showLeaderboard">
          <span class="btn-content">لوحة الصدارة</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Avatar Selection Screen -->
  <div id="avatarScreen" class="screen">
    <div class="content-box">
      <header class="screen-header">
        <h2>👤 اختر صورتك الرمزية</h2>
        <p class="screen-subtitle">يمكنك اختيار صورة افتراضية أو رفع صورة شخصية</p>
      </header>
      <div class="avatar-grid" role="group" aria-label="خيارات الصور الرمزية"></div>
      <div class="button-group">
        <button id="confirmAvatarBtn" class="btn-main" disabled data-action="showNameEntryScreen">
          <span class="btn-content">التالي</span>
        </button>
        <button class="btn-secondary" data-action="showStartScreen">
          <span class="btn-content">رجوع</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Name Entry Screen -->
  <div id="nameEntryScreen" class="screen">
    <div class="content-box">
      <header class="screen-header">
        <h2>✍️ أدخل اسمك</h2>
        <p class="screen-subtitle">سيظهر هذا الاسم في لوحة الصدارة</p>
      </header>
      <div class="form-group">
        <label for="nameInput" class="form-label">اسم اللاعب</label>
        <input type="text" id="nameInput" class="form-input" placeholder="مثال: عبد الله" maxlength="20" autocomplete="name" aria-required="true" aria-describedby="nameError">
        <div id="nameError" class="error-message" aria-live="polite"></div>
        <div class="form-hint">يجب أن يكون بين 3 و 20 حرفاً</div>
      </div>
      <div class="button-group">
        <button id="confirmNameBtn" class="btn-main" disabled data-action="confirmName">
          <span class="btn-content">تأكيد الإسم</span>
        </button>
        <button class="btn-secondary" data-action="showAvatarScreen">
          <span class="btn-content">رجوع</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Instructions Screen -->
  <div id="instructionsScreen" class="screen screen--align-top">
    <div class="content-box">
      <header class="screen-header">
        <h2>📋 إرشادات اللعب</h2>
        <p class="screen-subtitle">تعرف على قواعد المسابقة قبل البدء</p>
      </header>
      
      <div class="instructions-content">
        <div class="instruction-section">
          <h3 class="instruction-title">🎯 نظام اللعب</h3>
          <div class="instruction-item">
            <span class="instruction-icon">⏱️</span>
            <div class="instruction-text">
              <strong>الوقت:</strong> كل سؤال له وقت محدد للإجابة
            </div>
          </div>
          <div class="instruction-item">
            <span class="instruction-icon">⚖️</span>
            <div class="instruction-text">
              <strong>النقاط:</strong>
              <ul class="instruction-list">
                <li>إجابة صحيحة: <span class="positive">+100 نقطة</span></li>
                <li>إجابة خاطئة: <span class="negative">-100 نقطة</span></li>
              </ul>
            </div>
          </div>
        </div>

        <div class="instruction-section">
          <h3 class="instruction-title">🛠️ المساعدات</h3>
          <div class="instruction-item">
            <span class="instruction-icon">⏭️</span>
            <div class="instruction-text">
              <strong>تخطي السؤال:</strong> مجانية تماماً
            </div>
          </div>
          <div class="instruction-item">
            <span class="instruction-icon">🎯</span>
            <div class="instruction-text">
              <strong>50:50:</strong> إزالة خيارين خاطئين (100 نقطة)
            </div>
          </div>
          <div class="instruction-item">
            <span class="instruction-icon">❄️</span>
            <div class="instruction-text">
              <strong>تجميد الوقت:</strong> إيقاف المؤقت 10 ثوانٍ (100 نقطة)
            </div>
          </div>
        </div>

        <div class="instruction-section">
          <h3 class="instruction-title">📈 المستويات</h3>
          <div class="levels-grid">
            <div class="level-badge easy">سهل</div>
            <div class="level-badge medium">متوسط</div>
            <div class="level-badge hard">صعب</div>
            <div class="level-badge impossible">مستحيل</div>
          </div>
        </div>
      </div>

      <div class="button-group">
        <button class="btn-main" data-action="postInstructionsStart">
          <span class="btn-content">حسناً، لنبدأ!</span>
        </button>
        <button class="btn-secondary" data-action="showNameEntryScreen">
          <span class="btn-content">رجوع</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Game Screen -->
  <main id="gameContainer" class="screen" role="main">
    <div class="top-bar">
      <button class="end-quiz-btn" aria-label="إنهاء المسابقة" data-action="showConfirmExitModal">
        <span class="btn-icon">🚪</span>
        <span class="btn-text">إنهاء</span>
      </button>
      
      <div class="level-progress" aria-label="تقدم المستويات">
        <div class="level-indicator" data-level="easy" aria-label="المستوى السهل">
          <span class="level-number">1</span>
          <span class="level-name">سهل</span>
        </div>
        <div class="level-indicator" data-level="medium" aria-label="المستوى المتوسط">
          <span class="level-number">2</span>
          <span class="level-name">متوسط</span>
        </div>
        <div class="level-indicator" data-level="hard" aria-label="المستوى الصعب">
          <span class="level-number">3</span>
          <span class="level-name">صعب</span>
        </div>
        <div class="level-indicator" data-level="impossible" aria-label="المستوى المستحيل">
          <span class="level-number">4</span>
          <span class="level-name">مستحيل</span>
        </div>
      </div>
      
      <button class="theme-toggle-btn" aria-label="تبديل وضع السطوع والظلام" data-action="toggleTheme">
        <span class="theme-icon">☀️</span>
      </button>
    </div>

    <header class="game-header">
      <div class="player-info">
        <div class="player-main">
          <img id="playerAvatar" src="" alt="الصورة الرمزية للاعب" class="player-avatar" loading="lazy" decoding="async">
          <div class="player-details">
            <span id="playerName" class="player-name" aria-label="اسم اللاعب"></span>
            <span id="playerId" class="player-id" aria-label="معرف اللاعب"></span>
          </div>
        </div>
        
        <div class="player-stats">
          <div class="stat-item">
            <span class="stat-label">النقاط:</span>
            <strong id="currentScore" class="stat-value" aria-live="polite">100</strong>
          </div>
          <div class="stat-item">
            <span class="stat-label">الأخطاء:</span>
            <strong id="wrongAnswersCount" class="stat-value error" aria-live="assertive">0 / 3</strong>
          </div>
          <div class="stat-item">
            <span class="stat-label">التخطي:</span>
            <strong id="skipCount" class="stat-value">0</strong>
          </div>
        </div>
      </div>

      <div class="helpers" role="toolbar" aria-label="خيارات المساعدة">
        <button class="helper-btn" data-type="fiftyFifty" aria-describedby="fiftyFiftyDesc">
          <span class="helper-icon">50:50</span>
          <span class="helper-cost">100</span>
        </button>
        
        <button class="helper-btn" data-type="freezeTime" aria-describedby="freezeTimeDesc">
          <span class="helper-icon">❄️ 10ث</span>
          <span class="helper-cost">100</span>
        </button>
        
        <button class="helper-btn" data-type="skipQuestion" aria-describedby="skipQuestionDesc">
          <span class="helper-icon">⏭️</span>
          <span class="helper-cost free">مجاني</span>
        </button>

        <div class="sr-only">
          <span id="fiftyFiftyDesc">يزيل خيارين خاطئين. الاستخدام مرة واحدة لكل جولة. التكلفة 100 نقطة.</span>
          <span id="freezeTimeDesc">يوقف المؤقت 10 ثوانٍ. الاستخدام مرة واحدة لكل جولة. التكلفة 100 نقطة.</span>
          <span id="skipQuestionDesc">تخطي السؤال الحالي. مجانية تماماً.</span>
        </div>
      </div>
    </header>

    <div class="timer-container" aria-label="مؤقت السؤال">
      <div class="timer-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100">
        <div class="timer-fill"></div>
      </div>
      <span class="timer-text" aria-live="polite">80</span>
    </div>

    <div class="main-content">
      <section class="question-box" aria-labelledby="questionCounter questionText">
        <div class="question-header">
          <div class="level-badge current" id="currentLevelBadge">سهل</div>
          <h3 id="questionCounter" class="question-counter">السؤال 1 من 10</h3>
        </div>
        <div class="question-content">
          <p id="questionText" class="question-text" aria-live="polite"></p>
        </div>
      </section>
      
      <section class="options-container">
        <div class="options-grid" role="group" aria-label="خيارات الإجابة"></div>
      </section>
    </div>
  </main>

  <!-- Level Complete Screen -->
  <div id="levelCompleteScreen" class="screen">
    <div class="content-box">
      <header class="screen-header">
        <h2 id="levelCompleteTitle" class="success-title">🎉 أكملت المستوى!</h2>
        <p class="screen-subtitle">أحسنت! استعد للمستوى التالي</p>
      </header>
      
      <div class="level-stats">
        <div class="stat-card">
          <div class="stat-icon">⭐</div>
          <div class="stat-info">
            <span class="stat-label">النقاط الحالية</span>
            <strong id="levelScore" class="stat-value">0</strong>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">❌</div>
          <div class="stat-info">
            <span class="stat-label">عدد الأخطاء</span>
            <strong id="levelErrors" class="stat-value">0</strong>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">✅</div>
          <div class="stat-info">
            <span class="stat-label">الإجابات الصحيحة</span>
            <strong id="levelCorrect" class="stat-value">0</strong>
          </div>
        </div>
      </div>
      
      <div class="button-group">
        <button class="btn-main" data-action="nextLevel">
          <span class="btn-content">المستوى التالي</span>
        </button>
        <button class="btn-secondary" data-action="endGame">
          <span class="btn-content">الانسحاب وعرض النتائج</span>
        </button>
      </div>
    </div>
  </div>

  <!-- End Screen -->
  <div id="endScreen" class="screen screen--align-top">
    <div class="content-box">
      <header class="screen-header">
        <h2 class="success-title">🏆 النتائج النهائية</h2>
        <p class="screen-subtitle">تهانينا على إكمال المسابقة!</p>
      </header>
      
      <div class="final-stats">
        <div class="stats-grid">
          <div class="final-stat">
            <span class="stat-icon">✍️</span>
            <div class="stat-details">
              <span class="stat-label">الاسم</span>
              <strong id="finalName" class="stat-value"></strong>
            </div>
          </div>
          
          <div class="final-stat">
            <span class="stat-icon">🆔</span>
            <div class="stat-details">
              <span class="stat-label">المعرّف</span>
              <strong id="finalId" class="stat-value"></strong>
            </div>
          </div>
          
          <div class="final-stat">
            <span class="stat-icon">🔢</span>
            <div class="stat-details">
              <span class="stat-label">رقم المحاولة</span>
              <strong id="finalAttemptNumber" class="stat-value"></strong>
            </div>
          </div>
          
          <div class="final-stat">
            <span class="stat-icon">✅</span>
            <div class="stat-details">
              <span class="stat-label">الإجابات الصحيحة</span>
              <strong id="finalCorrect" class="stat-value"></strong>
            </div>
          </div>
          
          <div class="final-stat">
            <span class="stat-icon">❌</span>
            <div class="stat-details">
              <span class="stat-label">الإجابات الخاطئة</span>
              <strong id="finalWrong" class="stat-value"></strong>
            </div>
          </div>
          
          <div class="final-stat">
            <span class="stat-icon">⏭️</span>
            <div class="stat-details">
              <span class="stat-label">مرات التخطي</span>
              <strong id="finalSkips" class="stat-value"></strong>
            </div>
          </div>
          
          <div class="final-stat highlight">
            <span class="stat-icon">⭐</span>
            <div class="stat-details">
              <span class="stat-label">النقاط النهائية</span>
              <strong id="finalScore" class="stat-value"></strong>
            </div>
          </div>
          
          <div class="final-stat">
            <span class="stat-icon">⏱️</span>
            <div class="stat-details">
              <span class="stat-label">الوقت المستغرق</span>
              <strong id="totalTime" class="stat-value"></strong>
            </div>
          </div>
          
          <div class="final-stat">
            <span class="stat-icon">📈</span>
            <div class="stat-details">
              <span class="stat-label">المستوى الذي وصلت إليه</span>
              <strong id="finalLevel" class="stat-value"></strong>
            </div>
          </div>
          
          <div class="final-stat">
            <span class="stat-icon">🎯</span>
            <div class="stat-details">
              <span class="stat-label">نسبة الدقة</span>
              <strong id="finalAccuracy" class="stat-value"></strong>
            </div>
          </div>
          
          <div class="final-stat">
            <span class="stat-icon">⏳</span>
            <div class="stat-details">
              <span class="stat-label">متوسط وقت الإجابة</span>
              <strong id="finalAvgTime" class="stat-value"></strong>
            </div>
          </div>
        </div>
        
        <div class="performance-rating">
          <div class="rating-card">
            <span class="rating-icon">📊</span>
            <div class="rating-details">
              <span class="rating-label">تقييم أدائك</span>
              <strong id="performanceText" class="rating-value"></strong>
            </div>
          </div>
        </div>
      </div>

      <section class="share-section" aria-labelledby="shareTitle">
        <h3 id="shareTitle" class="share-title">📢 مشاركة النتائج</h3>
        <div class="share-buttons">
          <button class="share-btn x" data-action="shareOnX" aria-label="مشاركة على X">
            <span class="share-icon">𝕏</span>
            <span class="share-text">X</span>
          </button>
          <button class="share-btn instagram" data-action="shareOnInstagram" aria-label="مشاركة على Instagram">
            <span class="share-icon">📷</span>
            <span class="share-text">Instagram</span>
          </button>
        </div>
      </section>

      <div class="cooldown-notice" id="retryHint">
        <div class="cooldown-content">
          <span class="cooldown-icon">⏳</span>
          <div class="cooldown-text">
            يمكنك المحاولة مجددًا بعد <b id="retryCountdown">30</b> ثانية
          </div>
        </div>
      </div>
      
      <div class="button-group">
        <button id="playAgainBtn" class="btn-main" data-action="playAgain">
          <span class="btn-content">أعد اللعب</span>
        </button>
        <button class="btn-secondary" data-action="showLeaderboard">
          <span class="btn-content">لوحة الصدارة</span>
        </button>
        <button class="btn-secondary" data-action="showStartScreen">
          <span class="btn-content">العودة للرئيسية</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Leaderboard Screen -->
  <div id="leaderboardScreen" class="screen screen--align-top">
    <div class="content-box">
      <header class="screen-header">
        <h2>🏆 لوحة الصدارة</h2>
        <p class="screen-subtitle">أفضل اللاعبين وأعلى النتائج</p>
      </header>
     
      <div class="lb-filters">
        <div class="filter-group">
          <label for="lbMode" class="filter-label">نمط الترتيب:</label>
          <select id="lbMode" class="filter-select" aria-label="نمط ترتيب اللوحة">
            <option value="all">جميع النتائج</option>
            <option value="best" selected>أفضل نتيجة</option>
            <option value="attempt">حسب المحاولة</option>
            <option value="accuracy">أعلى دقة</option>
            <option value="time">أقل وقت</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="lbAttempt" class="filter-label">رقم المحاولة:</label>
          <select id="lbAttempt" class="filter-select" disabled aria-label="اختر رقم المحاولة">
            <option value="">جاري التحميل...</option>
          </select>
        </div>
      </div>
     
      <div id="leaderboardContent" class="leaderboard-content" aria-live="polite">
        <div class="loading-state">
          <div class="spinner small"></div>
          <p>جاري تحميل لوحة الصدارة...</p>
        </div>
      </div>
      
      <div class="button-group">
        <button class="btn-secondary" data-action="showStartScreen">
          <span class="btn-content">العودة للرئيسية</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ========== MODALS ========== -->

  <!-- Confirm Exit Modal -->
  <div id="confirmExitModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="confirmExitTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="confirmExitTitle" class="modal-title">⚠️ إنهاء المسابقة</h3>
      </div>
      <div class="modal-body">
        <p>سيتم حفظ نقاطك الحالية وحساب نتيجتك النهائية.</p>
        <p class="modal-hint">هل أنت متأكد من رغبتك في المتابعة؟</p>
      </div>
      <div class="modal-buttons">
        <button class="btn-main" data-action="endGame">
          <span class="btn-content">نعم، أنهِ المسابقة</span>
        </button>
        <button class="btn-secondary" data-action="closeModal" data-modal-id="confirmExitModal">
          <span class="btn-content">لا، استمر في اللعب</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Advanced Report Modal -->
  <div id="advancedReportModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="advancedReportTitle">
    <div class="modal-content large">
      <div class="modal-header">
        <h3 id="advancedReportTitle" class="modal-title">📩 الإبلاغ عن مشكلة</h3>
        <p class="modal-subtitle">ساعدنا في تحسين تجربة اللعب</p>
      </div>
      
      <form id="reportProblemForm" class="modal-form">
        <div class="form-group">
          <label for="problemType" class="form-label">نوع المشكلة:</label>
          <select id="problemType" name="problemType" class="form-select" required>
            <option value="">اختر نوع المشكلة...</option>
            <option value="technical">مشكلة تقنية (تجمد، بطء)</option>
            <option value="question_error">خطأ في السؤال أو الإجابة</option>
            <option value="translation_error">خطأ في الترجمة</option>
            <option value="inappropriate_content">محتوى غير مناسب</option>
            <option value="account_issue">مشكلة في الحساب أو النقاط</option>
            <option value="ui_ux">واجهة/تجربة المستخدم</option>
            <option value="performance">الأداء/السرعة</option>
            <option value="suggestion">اقتراح لتحسين اللعبة</option>
            <option value="other">أخرى</option>
          </select>
        </div>

        <div class="form-group">
          <label for="problemLocation" class="form-label">أين ظهرت المشكلة؟</label>
          <select id="problemLocation" name="problemLocation" class="form-select">
            <option value="unspecified">لم أحدد...</option>
            <option value="start">شاشة البداية</option>
            <option value="avatar">اختيار الصورة الرمزية</option>
            <option value="name">إدخال الاسم</option>
            <option value="instructions">شاشة التعليمات</option>
            <option value="game">أثناء اللعب</option>
            <option value="level_complete">إكمال المستوى</option>
            <option value="end">شاشة النتائج</option>
            <option value="leaderboard">لوحة الصدارة</option>
          </select>
        </div>

        <div class="form-group">
          <label for="problemDescription" class="form-label">وصف المشكلة:</label>
          <textarea id="problemDescription" name="problemDescription" class="form-textarea" placeholder="يرجى وصف المشكلة بالتفصيل... ما الذي حدث؟ متى؟ كيف يمكننا إعادة إنتاج المشكلة؟" required rows="4"></textarea>
          <div class="form-hint">كلما كانت التفاصيل أدق، ساعدتنا أكثر في حل المشكلة</div>
        </div>

        <div class="form-group">
          <label for="problemScreenshot" class="form-label">إرفاق صورة/لقطة شاشة:</label>
          <div class="file-upload">
            <input type="file" id="problemScreenshot" class="file-input" accept="image/*">
            <label for="problemScreenshot" class="file-label">
              <span class="file-icon">📎</span>
              <span class="file-text">اختر صورة</span>
            </label>
          </div>
          <div class="form-hint">اختياري - حجم الملف الأقصى 5MB</div>
          
          <div id="reportImagePreview" class="image-preview">
            <img alt="معاينة الصورة المرفوعة"/>
            <button type="button" class="remove-image" aria-label="إزالة الصورة">×</button>
          </div>
        </div>

        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" id="includeAutoDiagnostics" checked>
            <span class="checkmark"></span>
            <span class="checkbox-text">إرفاق معلومات التشخيص التلقائي</span>
          </label>
          <div class="form-hint">يساعدنا في تحديد سبب المشكلة بشكل أدق</div>
        </div>

        <div class="modal-buttons">
          <button type="submit" class="btn-main">
            <span class="btn-content">إرسال البلاغ</span>
          </button>
          <button type="button" class="btn-secondary" data-action="closeModal" data-modal-id="advancedReportModal">
            <span class="btn-content">إلغاء</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Avatar Editor Modal -->
  <div id="avatarEditorModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="avatarEditorTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="avatarEditorTitle" class="modal-title">🎨 تعديل الصورة الرمزية</h3>
        <p class="modal-subtitle">قم بقص الصورة لجعلها مربعة الشكل</p>
      </div>
      
      <div class="modal-body">
        <div id="image-editor-container" class="image-editor">
          <img id="image-to-crop" src="" alt="صورة للتقليم">
        </div>
      </div>
      
      <div class="modal-buttons">
        <button class="btn-main" data-action="saveCroppedAvatar">
          <span class="btn-content">💾 حفظ الصورة</span>
        </button>
        <button class="btn-secondary" data-action="closeModal" data-modal-id="avatarEditorModal">
          <span class="btn-content">إلغاء</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Player Details Modal -->
  <div id="playerDetailsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="playerDetailsTitle">
    <div class="modal-content large">
      <div class="modal-header">
        <div class="player-modal-header">
          <img id="detailsAvatar" src="" alt="صورة اللاعب الرمزية" class="player-modal-avatar">
          <div class="player-modal-info">
            <h3 id="playerDetailsTitle" class="modal-title">👤 تفاصيل اللاعب</h3>
            <div id="detailsName" class="player-modal-name"></div>
            <div id="detailsPlayerId" class="player-modal-id"></div>
          </div>
        </div>
      </div>
      
      <div class="modal-body">
        <div id="playerDetailsContent" class="player-details-body">
          <!-- سيتم تعبئته ديناميكياً -->
        </div>
      </div>
      
      <div class="modal-buttons">
        <button class="btn-secondary" data-action="closeModal" data-modal-id="playerDetailsModal">
          <span class="btn-content">إغلاق</span>
        </button>
      </div>
    </div>
  </div>

  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js" defer></script>

  <!-- App JS -->
  <script src="script.js?v=20" defer></script>
</body>
</html>
