<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="description" content="مسابقة معلومات تفاعلية شاملة تختبر ذكاءك وثقافتك في رحلة مليئة بالتحديات والمتعة التعليمية">
  <title>🧠 مسابقة المعلومات التفاعلية | تحدّي الذكاء والثقافة</title>

  <link rel="icon" type="image/png" href="https://em-content.zobj.net/thumbs/120/apple/354/brain_1f9e0.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">

  <!-- Cropper.js CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
  <link rel="stylesheet" href="style.css">

  <!-- JSON-LD for SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "VideoGame",
    "name": "🧠 مسابقة المعلومات التفاعلية",
    "description": "لعبة مسابقة تفاعلية شاملة تختبر الذكاء والثقافة في مستويات متعددة مع تحليل أداء مفصل",
    "applicationCategory": "GameApplication",
    "operatingSystem": "Web Browser",
    "author": { "@type": "Person", "name": "MS AbuQusay" },
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    }
  }
  </script>
</head>
<body data-theme="dark">
  <noscript>
    <div style="text-align: center; padding: 2rem; color: white; background: #1a1a1a;">
      <h2>⚠️ تفعيل JavaScript مطلوب</h2>
      <p>هذه اللعبة التفاعلية تتطلب تفعيل JavaScript في متصفحك للعمل بشكل صحيح.</p>
      <p>يرجى تفعيل JavaScript ثم إعادة تحميل الصفحة.</p>
    </div>
  </noscript>

  <div id="toast-container" class="toast-container" aria-live="assertive"></div>

  <!-- زر الإبلاغ عن المشاكل -->
  <div id="reportErrorFab" class="report-fab" role="button" aria-label="الإبلاغ عن مشكلة أو خطأ" title="الإبلاغ عن مشكلة">
    <span aria-hidden="true">⚠️</span>
    <span class="sr-only">الإبلاغ عن مشكلة في اللعبة</span>
  </div>

  <!-- الشاشات الرئيسية -->
  <div id="loader" class="screen active" role="status" aria-label="جاري تحميل اللعبة">
    <div class="spinner" aria-hidden="true"></div>
    <p id="loaderText" class="game-subtitle" style="margin-top: 1rem;">
      <span>جاري تحميل المحتوى التعليمي...</span>
      <br>
      <small style="opacity: 0.7; font-size: 0.9rem;">يرجى الانتظار، نحن نجهز تجربتك التعليمية</small>
    </p>
  </div>

  <div id="startScreen" class="screen">
    <div class="content-box">
      <header class="screen-header">
        <h1 class="game-title">🧠 مسابقة المعلومات التفاعلية</h1>
        <p class="game-subtitle">رحلة تعليمية شاملة تختبر ذكاءك وتوسع مداركك</p>
        <div class="welcome-message">
          <p>مرحباً بك في منصة الاختبارات التفاعلية! هنا ستخوض تجربة فريدة تجمع بين المتعة والتعلم.</p>
        </div>
      </header>
      
      <div class="features-grid">
        <div class="feature-item">
          <span class="feature-icon">🎯</span>
          <h3>مستويات متدرجة</h3>
          <p>ابدأ من المستوى السهل وتقدم نحو التحدي الأقصى</p>
        </div>
        <div class="feature-item">
          <span class="feature-icon">📊</span>
          <h3>تحليل أداء مفصل</h3>
          <p>احصل على تقرير شامل عن أدائك ومستوى تقدمك</p>
        </div>
        <div class="feature-item">
          <span class="feature-icon">🏆</span>
          <h3>منافسة شريفة</h3>
          <p>تنافس مع الآخرين في لوحة الصدارة التفاعلية</p>
        </div>
      </div>

      <div class="button-group">
        <button id="startBtn" class="btn-main" data-action="showAvatarScreen">
          <span>🚀 ابدأ الرحلة التعليمية</span>
        </button>
        <button data-action="showLeaderboard" class="btn-secondary">
          <span>📊 عرض لوحة الصدارة</span>
        </button>
      </div>

      <footer class="screen-footer">
        <p>🔥 <strong>جديد:</strong> نظام تحليل الأداء المتقدم ومقارنة النتائج</p>
      </footer>
    </div>
  </div>

  <div id="avatarScreen" class="screen">
    <div class="content-box">
      <header class="screen-header">
        <h2>👤 اختر صورتك الرمزية</h2>
        <p>اختر صورة تعبر عن شخصيتك في رحلتك التعليمية</p>
      </header>
      
      <div class="avatar-section">
        <div class="avatar-grid" role="group" aria-label="خيارات الصور الرمزية المتاحة"></div>
        <p class="avatar-note">يمكنك اختيار صورة من المكتبة أو رفع صورة خاصة بك</p>
      </div>

      <div class="button-group">
        <button id="confirmAvatarBtn" class="btn-main" disabled data-action="showNameEntryScreen">
          <span>👉 التالي إلى إدخال الاسم</span>
        </button>
        <button class="btn-secondary" data-action="showStartScreen">
          <span>↩️ العودة للرئيسية</span>
        </button>
      </div>
    </div>
  </div>

  <div id="nameEntryScreen" class="screen">
    <div class="content-box">
      <header class="screen-header">
        <h2>✍️ أدخل اسمك</h2>
        <p>اختر اسمًا يمثلك في عالم المسابقات التعليمية</p>
      </header>
      
      <div class="form-group">
        <label for="nameInput" class="form-label">الاسم الشخصي</label>
        <input type="text" id="nameInput" placeholder="مثال: أحمد، سارة، عبدالله..." 
               maxlength="25" autocomplete="name" aria-required="true" 
               aria-describedby="nameError nameHelp">
        <div id="nameHelp" class="form-help">
          يمكنك استخدام اسمك الحقيقي أو اسم مستعار تعبر به عن شخصيتك
        </div>
        <div id="nameError" class="error-message" aria-live="polite"></div>
      </div>

      <div class="button-group">
        <button id="confirmNameBtn" class="btn-main" disabled data-action="confirmName">
          <span>📝 تأكيد الاسم والمتابعة</span>
        </button>
        <button class="btn-secondary" data-action="showAvatarScreen">
          <span>↩️ العودة للخلف</span>
        </button>
      </div>
    </div>
  </div>

  <div id="instructionsScreen" class="screen screen--align-top">
    <div class="content-box">
      <header class="screen-header">
        <h2>📚 دليل اللعب الشامل</h2>
        <p>تعرف على قواعد المسابقة وآلية التقييم</p>
      </header>
      
      <div class="instructions-content">
        <div class="instruction-section">
          <h3>🎮 آلية اللعب</h3>
          <div class="instruction-item">
            <span class="instruction-icon">⏱️</span>
            <div>
              <strong>الوقت المخصص:</strong>
              <p>كل سؤال لديه وقت محدد للإجابة، استخدم وقتك بحكمة!</p>
            </div>
          </div>
          
          <div class="instruction-item">
            <span class="instruction-icon">⚖️</span>
            <div>
              <strong>نظام النقاط:</strong>
              <ul>
                <li>✅ الإجابة الصحيحة: <strong>+100 نقطة</strong></li>
                <li>❌ الإجابة الخاطئة: <strong>-100 نقطة</strong></li>
                <li>🎯 الدقة في الإجابة تحسن من تقييمك النهائي</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="instruction-section">
          <h3>🛠️ أدوات المساعدة</h3>
          <div class="instruction-item">
            <span class="instruction-icon">🎯</span>
            <div>
              <strong>50:50</strong>
              <p>تزيل خيارين خاطئين - التكلفة: 100 نقطة</p>
            </div>
          </div>
          
          <div class="instruction-item">
            <span class="instruction-icon">❄️</span>
            <div>
              <strong>تجميد الوقت</strong>
              <p>توقف المؤقت لمدة 10 ثوانٍ - التكلفة: 100 نقطة</p>
            </div>
          </div>
          
          <div class="instruction-item">
            <span class="instruction-icon">⏭️</span>
            <div>
              <strong>تخطي السؤال</strong>
              <p>انتقل للسؤال التالي مباشرة - <strong>مجاني تمامًا</strong></p>
            </div>
          </div>
        </div>

        <div class="instruction-section">
          <h3>📈 المستويات والتقدم</h3>
          <div class="instruction-item">
            <span class="instruction-icon">🎯</span>
            <div class="levels-list">
              <strong>المستويات الأربعة:</strong>
              <div class="level-desc">
                <span class="level-badge easy">1. سهل</span> - للمبتدئين
              </div>
              <div class="level-desc">
                <span class="level-badge medium">2. متوسط</span> - مستوى التحدي
              </div>
              <div class="level-desc">
                <span class="level-badge hard">3. صعب</span> - لذوي الخبرة
              </div>
              <div class="level-desc">
                <span class="level-badge impossible">4. مستحيل</span> - تحدي النخبة
              </div>
            </div>
          </div>
        </div>

        <div class="instruction-section">
          <h3>📞 الدعم والمساندة</h3>
          <div class="instruction-item">
            <span class="instruction-icon">💬</span>
            <div>
              <strong>قنوات التواصل:</strong>
              <ul>
                <li>📱 تويتر: <a href="https://x.com/_MS_AbuQusay" target="_blank" rel="noopener noreferrer">@_MS_AbuQusay</a></li>
                <li>📸 إنستغرام: <a href="https://www.instagram.com/_ms_abuqusay" target="_blank" rel="noopener noreferrer">@_ms_abuqusay</a></li>
              </ul>
              <p>نحن هنا لمساعدتك في أي استفسار أو مشكلة تواجهك</p>
            </div>
          </div>
        </div>
      </div>

      <div class="button-group">
        <button class="btn-main" data-action="postInstructionsStart">
          <span>🚀 فهمت، فلنبدأ التحدي!</span>
        </button>
        <button class="btn-secondary" data-action="showNameEntryScreen">
          <span>↩️ العودة للخلف</span>
        </button>
      </div>
    </div>
  </div>

  <!-- باقي الكود يتبع نفس النمط مع إضافة محتوى تفصيلي -->
  <!-- للحفاظ على الإجابة موجزة، سيتم تضمين الأجزاء الرئيسية فقط -->

  <main id="gameContainer" class="screen">
    <!-- تم تحسين النصوص في الواجهة مع إضافة تفاصيل أكثر -->
    <div class="top-bar">
      <button class="end-quiz-btn" aria-label="إنهاء المسابقة والحفاظ على النقاط" data-action="showConfirmExitModal">
        <span>🚪 إنهاء المسابقة</span>
      </button>
      <div class="level-progress">
        <div class="level-indicator" data-level="easy" data-tooltip="المستوى السهل - نقطة انطلاق رحلتك التعليمية">
          <span>1</span>
          <div class="level-tooltip">سهل</div>
        </div>
        <div class="level-indicator" data-level="medium" data-tooltip="المستوى المتوسط - اختبار لقدراتك الفعلية">
          <span>2</span>
          <div class="level-tooltip">متوسط</div>
        </div>
        <div class="level-indicator" data-level="hard" data-tooltip="المستوى الصعب - تحدي حقيقي للمتمرسين">
          <span>3</span>
          <div class="level-tooltip">صعب</div>
        </div>
        <div class="level-indicator" data-level="impossible" data-tooltip="المستوى المستحيل - اختبار النخبة">
          <span>4</span>
          <div class="level-tooltip">مستحيل</div>
        </div>
      </div>
      <button class="theme-toggle-btn" aria-label="تبديل وضع السطوع والظلام" data-action="toggleTheme">
        <span>☀️</span>
      </button>
    </div>

    <!-- تم تحسين النصوص في باقي الأقسام بنفس النمط -->
    <!-- ... -->

  </main>

  <!-- شاشة انتهاء المستوى -->
  <div id="levelCompleteScreen" class="screen">
    <div class="content-box">
      <header class="screen-header">
        <h2 id="levelCompleteTitle">🎉 تهانينا! أكملت المستوى بنجاح</h2>
        <p>أداؤك ممتاز، استعد للمرحلة التالية من التحدي</p>
      </header>
      
      <div class="level-stats">
        <div class="stat-card">
          <div class="stat-icon">⭐</div>
          <div class="stat-info">
            <span class="stat-label">النقاط الحالية</span>
            <span class="stat-value" id="levelScore">0</span>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">❌</div>
          <div class="stat-info">
            <span class="stat-label">عدد الأخطاء</span>
            <span class="stat-value" id="levelErrors">0</span>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">✅</div>
          <div class="stat-info">
            <span class="stat-label">الإجابات الصحيحة</span>
            <span class="stat-value" id="levelCorrect">0</span>
          </div>
        </div>
      </div>

      <div class="performance-feedback">
        <h3>📈 ملاحظات أدائك:</h3>
        <p>أداؤك في هذا المستوى يدل على <strong>قدرة تحليلية جيدة</strong> واستيعاب ممتاز للمعلومات.</p>
        <p>استمر في التركيز وحافظ على هذا المستوى الرائع!</p>
      </div>

      <div class="button-group">
        <button class="btn-main" data-action="nextLevel">
          <span>🎯 الانتقال للمستوى التالي</span>
        </button>
        <button class="btn-secondary" data-action="endGame">
          <span>📊 الانسحاب وعرض النتائج النهائية</span>
        </button>
      </div>
    </div>
  </div>

  <!-- شاشة النتائج النهائية -->
  <div id="endScreen" class="screen screen--align-top">
    <div class="content-box">
      <header class="screen-header">
        <h2>🏆 التقرير النهائي لأدائك 🏆</h2>
        <p>تحليل شامل لرحلتك التعليمية وإنجازاتك</p>
      </header>
      
      <div class="final-stats-grid">
        <div class="final-stat-section">
          <h3>👤 المعلومات الشخصية</h3>
          <div class="final-stats">
            <div class="final-stat-item">
              <span class="stat-icon">✍️</span>
              <div>
                <span class="stat-label">الاسم:</span>
                <span class="stat-value" id="finalName">-</span>
              </div>
            </div>
            <div class="final-stat-item">
              <span class="stat-icon">🆔</span>
              <div>
                <span class="stat-label">المعرّف:</span>
                <span class="stat-value" id="finalId">-</span>
              </div>
            </div>
            <div class="final-stat-item">
              <span class="stat-icon">🔢</span>
              <div>
                <span class="stat-label">رقم المحاولة:</span>
                <span class="stat-value" id="finalAttemptNumber">-</span>
              </div>
            </div>
          </div>
        </div>

        <div class="final-stat-section">
          <h3>📊 الإنجازات</h3>
          <div class="final-stats">
            <div class="final-stat-item">
              <span class="stat-icon">✅</span>
              <div>
                <span class="stat-label">الإجابات الصحيحة:</span>
                <span class="stat-value" id="finalCorrect">0</span>
              </div>
            </div>
            <div class="final-stat-item">
              <span class="stat-icon">❌</span>
              <div>
                <span class="stat-label">الإجابات الخاطئة:</span>
                <span class="stat-value" id="finalWrong">0</span>
              </div>
            </div>
            <div class="final-stat-item">
              <span class="stat-icon">⏭️</span>
              <div>
                <span class="stat-label">مرات التخطي:</span>
                <span class="stat-value" id="finalSkips">0</span>
              </div>
            </div>
          </div>
        </div>

        <div class="final-stat-section">
          <h3>⏱️ الأداء الزمني</h3>
          <div class="final-stats">
            <div class="final-stat-item">
              <span class="stat-icon">⭐</span>
              <div>
                <span class="stat-label">النقاط النهائية:</span>
                <span class="stat-value" id="finalScore">0</span>
              </div>
            </div>
            <div class="final-stat-item">
              <span class="stat-icon">⏱️</span>
              <div>
                <span class="stat-label">الوقت المستغرق:</span>
                <span class="stat-value" id="totalTime">0:00</span>
              </div>
            </div>
            <div class="final-stat-item">
              <span class="stat-icon">📈</span>
              <div>
                <span class="stat-label">المستوى المنجز:</span>
                <span class="stat-value" id="finalLevel">-</span>
              </div>
            </div>
          </div>
        </div>

        <div class="final-stat-section">
          <h3>🎯 التحليل النوعي</h3>
          <div class="final-stats">
            <div class="final-stat-item">
              <span class="stat-icon">🎯</span>
              <div>
                <span class="stat-label">نسبة الدقة:</span>
                <span class="stat-value" id="finalAccuracy">0%</span>
              </div>
            </div>
            <div class="final-stat-item">
              <span class="stat-icon">⏳</span>
              <div>
                <span class="stat-label">متوسط وقت الإجابة:</span>
                <span class="stat-value" id="finalAvgTime">0:00</span>
              </div>
            </div>
            <div class="final-stat-item performance-item">
              <span class="stat-icon">📊</span>
              <div>
                <span class="stat-label">التقييم النهائي:</span>
                <span class="stat-value performance-text" id="performanceText">-</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="performance-analysis">
        <h3>🧠 تحليل الأداء التفصيلي</h3>
        <div class="analysis-content">
          <p>بناءً على أدائك في هذه الجولة، نلاحظ ما يلي:</p>
          <ul>
            <li>✅ <strong>نقاط القوة:</strong> سرعة البديهة في الأسئلة السهلة والمتوسطة</li>
            <li>📈 <strong>مجالات التحسين:</strong> يمكنك تحسين الأداء في الأسئلة المعقدة</li>
            <li>🎯 <strong>نصيحة:</strong> التركيز على دقة الإجابة يرفع من تقييمك النهائي</li>
          </ul>
        </div>
      </div>

      <section class="share-section">
        <h3>📢 مشاركة الإنجاز</h3>
        <p>شارك إنجازك مع الأصدقاء وتحداهم لتحقيق نتائج أفضل!</p>
        <div class="share-buttons">
          <button class="share-btn x" data-action="shareOnX" aria-label="مشاركة النتائج على X">
            <span>𝕏</span>
            <span>مشاركة على X</span>
          </button>
          <button class="share-btn instagram" data-action="shareOnInstagram" aria-label="مشاركة النتائج على Instagram">
            <span>📷</span>
            <span>مشاركة على Instagram</span>
          </button>
        </div>
      </section>

      <div class="cooldown-notice">
        <p id="retryHint">
          ⏳ يمكنك بدء محاولة جديدة بعد <b id="retryCountdown">30</b> ثانية من الآن
        </p>
        <p class="cooldown-help">هذا الوقت يساعدك في مراجعة أدائك والاستعداد للمحاولة القادمة</p>
      </div>
      
      <div class="button-group">
        <button id="playAgainBtn" class="btn-main" data-action="playAgain">
          <span>🔄 بدء محاولة جديدة</span>
        </button>
        <button class="btn-secondary" data-action="showLeaderboard">
          <span>📊 عرض لوحة الصدارة</span>
        </button>
        <button class="btn-secondary" data-action="showStartScreen">
          <span>🏠 العودة للرئيسية</span>
        </button>
      </div>
    </div>
  </div>

  <!-- باقي الشاشات والمودالات تتبع نفس النمط -->
  <!-- ... -->

  <!-- التعديلات على CSS ستكون ضرورية لدعم التصميم الجديد -->
  <style>
    /* إضافة أنماط جديدة لدعم المحتوى الموسع */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin: 2rem 0;
    }
    
    .feature-item {
      text-align: center;
      padding: 1.5rem;
      background: var(--card-bg);
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }
    
    .feature-icon {
      font-size: 2.5rem;
      display: block;
      margin-bottom: 0.5rem;
    }
    
    .instruction-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: var(--card-bg);
      border-radius: 12px;
      border-left: 4px solid var(--primary-color);
    }
    
    .final-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }
    
    .final-stat-section {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }
    
    .stat-card {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-color);
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }
    
    .performance-analysis {
      background: linear-gradient(135deg, var(--card-bg), var(--bg-color));
      padding: 1.5rem;
      border-radius: 12px;
      margin: 2rem 0;
      border-left: 4px solid var(--success-color);
    }
    
    /* تحسينات للاستجابة */
    @media (max-width: 768px) {
      .features-grid {
        grid-template-columns: 1fr;
      }
      
      .final-stats-grid {
        grid-template-columns: 1fr;
      }
      
      .instruction-section {
        padding: 1rem;
      }
    }
  </style>

  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js" defer></script>

  <!-- App JS -->
  <script src="script.js?v=20" defer></script>
</body>
</html>
